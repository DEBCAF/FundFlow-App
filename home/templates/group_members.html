{% extends "layout.html" %}
{% block content %}
<div class="content-section">
    <h1 class="mb-4">{{ group.name }} Members</h1>
    
    <!-- Admin Members -->
    <div class="card mb-4">
        <div class="card-header bg-warning text-dark">
            <h5 class="mb-0">Administrators</h5>
        </div>
        <div class="card-body">
            {% for member in group.members %}
                {% if member.role == 'admin' and member.is_active %}
                    <div class="d-flex justify-content-between align-items-center p-2 border rounded mb-2">
                        <div>
                            <strong>{{ member.user.username }}</strong>
                            <small class="text-muted">Joined {{ member.joined_at.strftime('%Y-%m-%d') }}</small>
                        </div>
                        {% if member.role == 'admin' and member.user_id != current_user.id and current_user_member.role == 'admin' %}
                            <div>
                                <form method="POST" action="{{ url_for('demote_member', group_id=group.id, member_id=member.id) }}" style="display: inline;">
                                    <button type="submit" class="btn btn-warning btn-sm">Demote to Member</button>
                                </form>
                            </div>
                        {% endif %}
                    </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>
    
    <!-- Regular Members -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">Members</h5>
        </div>
        <div class="card-body">
            {% for member_item in group.members %}
                {% if member_item.role == 'member' %}
                    <div class="d-flex justify-content-between align-items-center p-2 border rounded mb-2">
                        <div>
                            <strong>{{ member_item.user.username }}</strong>
                            <small class="text-muted">Joined {{ member_item.joined_at.strftime('%Y-%m-%d') }}</small>
                            {% if not member_item.is_active %}
                                <span class="badge bg-secondary">Inactive</span>
                            {% endif %}
                        </div>
                        {% if current_user_member.role == 'admin' %}
                            <div>
                                <form method="POST" action="{{ url_for('promote_member', group_id=group.id, member_id=member_item.id) }}" style="display: inline;">
                                    <button type="submit" class="btn btn-success btn-sm">Promote to Admin</button>
                                </form>
                                {% if member_item.is_active %}
                                    <form method="POST" action="{{ url_for('remove_member', group_id=group.id, member_id=member_item.id) }}" style="display: inline;">
                                        <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to remove this member?')">Remove</button>
                                    </form>
                                {% else %}
                                    <span class="text-muted">Already removed</span>
                                {% endif %}
                            </div>
                        {% endif %}
                    </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>
    
    <div class="text-center">
        <a href="{{ url_for('group_detail', group_id=group.id) }}" class="btn btn-outline-primary">Back to Group</a>
    </div>
</div>
{% endblock %}
