{% extends "layout.html" %}
{% block content %}
    <article class="media content-section {% if goal.status == 'completed' %}border-success bg-light{% endif %}">
        <img class="rounded-circle article-img" src="{{ url_for('static', filename='profile_pics/' + goal.owner.image_file) }}">
        <div class="media-body">
            <div class="article-metadata">
                <a class="mr-2" href="{{ url_for('user_goals', username=goal.owner.username)}}">{{ goal.owner.username }}</a>
                <small class="text-muted"> {{ goal.date_time.strftime('%Y-%m-%d') }}</small>
                {% if goal.status == 'completed' %}
                    <span class="badge bg-success ms-2">COMPLETED</span>
                {% endif %}
            </div>
            <h2 class="article-title">{{ goal.title }}</h2>
            <p class="article-content">{{ goal.description }}</p>
            
            <div class="mt-3">
                <p><strong>Target Amount:</strong> ${{ '%.2f'|format(goal.target_amount) }}</p>
                {% if goal.deadline %}
                    <p><strong>Deadline:</strong> {{ goal.deadline.strftime('%Y-%m-%d') }}</p>
                {% endif %}
                {% if goal.category %}
                    <p><strong>Category:</strong> {{ goal.category.title() }}</p>
                {% endif %}
                <p><strong>Status:</strong> {{ goal.status.title() }}</p>
            </div>
            
            <div class="mt-4">
                {% if goal.status != 'completed' and current_user.savings >= goal.target_amount and goal.user_id == current_user.id %}
                    <form method="POST" action="{{ url_for('complete_goal', goal_id=goal.id) }}" style="display: inline;">
                        <button type="submit" class="btn btn-success btn-lg">Complete & Spend ${{ '%.2f'|format(goal.target_amount) }}</button>
                    </form>
                {% elif goal.status == 'completed' %}
                    <div class="alert alert-success">
                        <h4>✓ Goal Completed!</h4>
                        <p>This goal was completed on {{ goal.date_time.strftime('%Y-%m-%d') }}</p>
                    </div>
                {% elif current_user.savings < goal.target_amount and goal.user_id == current_user.id %}
                    <div class="alert alert-warning">
                        <h4>⚠ Insufficient Funds</h4>
                        <p>You need ${{ '%.2f'|format(goal.target_amount - current_user.savings) }} more to complete this goal.</p>
                    </div>
                {% endif %}
                
                {% if goal.user_id == current_user.id %}
                    <a class="btn btn-secondary" href="{{ url_for('update_goal', goal_id=goal.id) }}">Edit Goal</a>
                    <form method="POST" action="{{ url_for('delete_goal', goal_id=goal.id) }}" style="display: inline;">
                        <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this goal?')">Delete Goal</button>
                    </form>
                {% endif %}
            </div>
        </div>
    </article>
{% endblock %}