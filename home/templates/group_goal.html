{% extends "layout.html" %}
{% block content %}
<article class="media content-section {% if goal.status in ['completed','approved'] %}border-success bg-light{% elif goal.status == 'denied' %}border-danger{% endif %}">
    <div class="media-body">
        <div class="article-metadata mb-2">
            <small class="text-muted">Group: <a href="{{ url_for('group_detail', group_id=group.id) }}">{{ group.name }}</a></small>
            <small class="text-muted float-end">Status: <span class="badge {% if goal.status == 'approved' %}bg-success{% elif goal.status == 'denied' %}bg-danger{% else %}bg-secondary{% endif %}">{{ goal.status.title() }}</span></small>
        </div>
        <h2 class="article-title">{{ goal.title }}</h2>
        <p class="article-content">{{ goal.description }}</p>
        <div class="mt-3">
            <p><strong>Target Amount:</strong> {{ group.currency }} {{ '%.2f'|format(goal.target_amount) }}</p>
            {% if goal.deadline %}
                <p><strong>Deadline:</strong> {{ goal.deadline.strftime('%Y-%m-%d') }}</p>
            {% endif %}
            <p><strong>Proposed By:</strong> {{ goal.proposer.username }}</p>
            {% if goal.approved_by %}
                <p><strong>Approved By:</strong> {{ goal.approved_by.username }}</p>
            {% endif %}
        </div>

        <div class="mt-4">
            {% if goal.status != 'denied' %}
                <div class="card p-3 mb-3">
                    <h5 class="mb-2">Analytics</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="small text-muted">Remaining: {{ '%.2f'|format(remaining) }}</div>
                            <div>{% if is_ready %}<span class="text-success">Ready to complete</span>{% else %}<span class="text-muted">Insufficient funds</span>{% endif %}</div>
                        </div>
                        <div class="col-md-6">
                            <div class="small text-muted">Rate/day: {{ '%.2f'|format(goal_analytics.rate_per_day) if goal_analytics.rate_per_day else 'N/A' }} </div>
                            <div class="small text-muted mt-2">ETA: {{ goal_analytics.eta_ts|timestamp_to_date if goal_analytics.eta_ts else 'N/A'}}</div>
                        </div>
                        <div class="col-md-6">
                            <div class="small text-muted mt-2">Progress: {{ '%.2f'|format(goal_analytics.progress_percent if goal_analytics.progress_percent is not none else 0) }}%</div>  
                        </div>
                        <div class="col-md-6">
                            <div class="small text-muted mt-2">Required Daily (30d): {% if goal_analytics.required_daily_30 %}{{ '%.2f'|format(goal_analytics.required_daily_30) }}{% else %}N/A{% endif %}</div>
                        </div>
                    </div>
                    {% if not goal_analytics.rate_per_day %}
                        <div class="mt-2 text-warning">Insufficient transaction data for analysis</div>
                    {% endif %}
                </div>
            {% else %}
                <div class="alert alert-secondary">No analysis is shown for denied goals.</div>
            {% endif %}
        </div>

        <div class="mt-3">
            <a href="{{ url_for('view_group_goals', group_id=group.id) }}" class="btn btn-outline-primary">Back to Goals</a>
        </div>
    </div>
</article>
{% endblock %}
